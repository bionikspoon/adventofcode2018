import { simulateGenerationsRepr, simulateGenerationsSum } from '.'
import { getInput } from '../utils/tests'

describe.each`
  file            | generations | padLeft | expectedSum | expectedState
  ${'case-1.txt'} | ${0}        | ${3}    | ${145}      | ${'...#..#.#..##......###...###...........'}
  ${'case-1.txt'} | ${1}        | ${1}    | ${91}       | ${'...#...#....#.....#..#..#..#...........'}
  ${'case-1.txt'} | ${2}        | ${1}    | ${132}      | ${'...##..##...##....#..#..#..##..........'}
  ${'case-1.txt'} | ${3}        | ${0}    | ${102}      | ${'..#.#...#..#.#....#..#..#...#..........'}
  ${'case-1.txt'} | ${4}        | ${0}    | ${154}      | ${'...#.#..#...#.#...#..#..##..##.........'}
  ${'case-1.txt'} | ${5}        | ${0}    | ${115}      | ${'....#...##...#.#..#..#...#...#.........'}
  ${'case-1.txt'} | ${6}        | ${0}    | ${174}      | ${'....##.#.#....#...#..##..##..##........'}
  ${'case-1.txt'} | ${7}        | ${0}    | ${126}      | ${'...#..###.#...##..#...#...#...#........'}
  ${'case-1.txt'} | ${8}        | ${0}    | ${213}      | ${'...#....##.#.#.#..##..##..##..##.......'}
  ${'case-1.txt'} | ${9}        | ${0}    | ${138}      | ${'...##..#..#####....#...#...#...#.......'}
  ${'case-1.txt'} | ${10}       | ${0}    | ${213}      | ${'..#.#..#...#.##....##..##..##..##......'}
  ${'case-1.txt'} | ${11}       | ${0}    | ${136}      | ${'...#...##...#.#...#.#...#...#...#......'}
  ${'case-1.txt'} | ${12}       | ${0}    | ${218}      | ${'...##.#.#....#.#...#.#..##..##..##.....'}
  ${'case-1.txt'} | ${13}       | ${0}    | ${133}      | ${'..#..###.#....#.#...#....#...#...#.....'}
  ${'case-1.txt'} | ${14}       | ${0}    | ${235}      | ${'..#....##.#....#.#..##...##..##..##....'}
  ${'case-1.txt'} | ${15}       | ${0}    | ${149}      | ${'..##..#..#.#....#....#..#.#...#...#....'}
  ${'case-1.txt'} | ${16}       | ${-1}   | ${226}      | ${'.#.#..#...#.#...##...#...#.#..##..##...'}
  ${'case-1.txt'} | ${17}       | ${-1}   | ${170}      | ${'..#...##...#.#.#.#...##...#....#...#...'}
  ${'case-1.txt'} | ${18}       | ${-1}   | ${280}      | ${'..##.#.#....#####.#.#.#...##...##..##..'}
  ${'case-1.txt'} | ${19}       | ${-1}   | ${287}      | ${'.#..###.#..#.#.#######.#.#.#..#.#...#..'}
  ${'case-1.txt'} | ${20}       | ${-1}   | ${325}      | ${'.#....##....#####...#######....#.#..##.'}
  ${'input.txt'}  | ${0}        | ${4}    | ${1623}     | ${'....#.#.#....##...##...##...#.##.#.###...#.##...#....#.#...#.##.........#.#...#..##.#.....#..#.###.....................'}
  ${'input.txt'}  | ${1}        | ${2}    | ${1520}     | ${'....####.#..#...##...##...#.#.#..#...#.#.#.#..#..#...##.##.#.#..........##.##..#.....#.....###...#.....................'}
  ${'input.txt'}  | ${2}        | ${1}    | ${1779}     | ${'...#.##...##.###...##...#.####.##.##.######.##.##.###...#..##.#........#...#..#.#.....#...#..#.#..#....................'}
  ${'input.txt'}  | ${3}        | ${1}    | ${1933}     | ${'...#.#..##.....#.##...#.#..##..#..#...####..#..#....#.#..#.....#........##..####.#.....##..####.##.#...................'}
  ${'input.txt'}  | ${4}        | ${1}    | ${1605}     | ${'...##.#........#.#..#.##.#....#.##.###.###.#.##.#...##.##.#.....#......#.....##...#...#.....##..#...#..................'}
  ${'input.txt'}  | ${5}        | ${0}    | ${1468}     | ${'..#....#.......##.###.#...#...#.#..........#.#...###...#...#.....#......#...#...#..##..#...#...#.##..#.................'}
  ${'input.txt'}  | ${6}        | ${0}    | ${1877}     | ${'...#....#.....#........##..##.##.#.........##.###..#.#..##..#.....#......##..##..#....#.##..##.#.#..#.#................'}
  ${'input.txt'}  | ${7}        | ${0}    | ${1590}     | ${'....#....#.....#......#.......#...#.......#.....#.###.#....#.#.....#....#.......#.#...#.#......##.####.#...............'}
  ${'input.txt'}  | ${8}        | ${0}    | ${1503}     | ${'.....#....#.....#......#.......##..#.......#....#......#...##.#.....#....#......##.##.##.#....#....##...#..............'}
  ${'input.txt'}  | ${9}        | ${0}    | ${1274}     | ${'......#....#.....#......#.....#...#.#.......#....#......###....#.....#....#....#...#..#...#....#..#...#..#.............'}
  ${'input.txt'}  | ${10}       | ${0}    | ${1829}     | ${'.......#....#.....#......#.....##.##.#.......#....#....#..#.....#.....#....#....##..##.##..#....##.##..##.#............'}
  ${'input.txt'}  | ${11}       | ${0}    | ${1210}     | ${'........#....#.....#......#...#...#...#.......#....#....##.#.....#.....#....#..#.......#..#.#..#...#.......#...........'}
  ${'input.txt'}  | ${12}       | ${0}    | ${1688}     | ${'.........#....#.....#......##..##..##..#.......#....#..#....#.....#.....#....##.#.......####.##.##..#.......#..........'}
  ${'input.txt'}  | ${13}       | ${0}    | ${1391}     | ${'..........#....#.....#....#...........#.#.......#....##.#....#.....#.....#..#....#.....#.##..#..#..#.#.......#.........'}
  ${'input.txt'}  | ${14}       | ${0}    | ${1745}     | ${'...........#....#.....#....#..........##.#.......#..#....#....#.....#.....##.#....#....#.#..#.##.####.#.......#........'}
  ${'input.txt'}  | ${15}       | ${0}    | ${1590}     | ${'............#....#.....#....#........#....#.......##.#....#....#.....#...#....#....#...##.###.#...##...#.......#.......'}
  ${'input.txt'}  | ${16}       | ${0}    | ${1453}     | ${'.............#....#.....#....#........#....#.....#....#....#....#.....##..#....#....###........###...#..#.......#......'}
  ${'input.txt'}  | ${17}       | ${0}    | ${1488}     | ${'..............#....#.....#....#........#....#.....#....#....#....#...#...#.#....#..#..#.......#..#.#..##.#.......#.....'}
  ${'input.txt'}  | ${18}       | ${0}    | ${1855}     | ${'...............#....#.....#....#........#....#.....#....#....#....##..##.##.#....##.##.#.......####.#.....#.......#....'}
  ${'input.txt'}  | ${19}       | ${0}    | ${1347}     | ${'................#....#.....#....#........#....#.....#....#....#..#.......#...#..#...#...#.....#.##...#.....#.......#...'}
  ${'input.txt'}  | ${20}       | ${0}    | ${1733}     | ${'.................#....#.....#....#........#....#.....#....#....##.#.......##..##.##..##..#....#.#..#..#.....#.......#..'}
`(
  'given file $file',
  ({ file, generations, expectedState, padLeft, expectedSum }) => {
    let input: string

    beforeEach(async () => {
      input = await getInput(__dirname, file)
    })

    describe(`given ${generations} generation(s)`, () => {
      test(`it has a state`, () => {
        expect(
          pad(
            simulateGenerationsRepr(input, generations),
            padLeft,
            expectedState.length
          )
        ).toEqual(expectedState)
      })

      test('it has sum', () => {
        expect(simulateGenerationsSum(input, generations)).toEqual(expectedSum)
      })
    })
  }
)

function pad(value: string, padLeft: number, expectedLength: number) {
  return padLeft >= 0
    ? value.padEnd(expectedLength - padLeft, '.').padStart(expectedLength, '.')
    : value
        .slice(padLeft * -1)
        .padEnd(expectedLength, '.')
        .slice(0, expectedLength)
}
